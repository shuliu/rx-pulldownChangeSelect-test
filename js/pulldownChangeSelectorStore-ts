import { Observable } from "rxjs";

interface renderSelectOptionInterface {
    (suggestArr: object[]): void;
}


/** 設定路徑 */
const baseUrl = '//apis.senao.com.tw/apis/senao_online/EC_S3Resource.jsp?apiKey=';
const storeUrl = baseUrl + 'APP_SenaoOnlineStore_type2.json';

/** DOM */
let storeGroupDOM: HTMLDivElement = <HTMLDivElement>document.querySelector('.pulldownChangeSelectorStore-group');
let cityDOM: HTMLDivElement = <HTMLDivElement>storeGroupDOM.querySelector('.pulldownChange-city');
let townDOM: HTMLDivElement = <HTMLDivElement>storeGroupDOM.querySelector('.pulldownChange-town');
let storeDOM: HTMLDivElement = <HTMLDivElement>storeGroupDOM.querySelector('.pulldownChange-store');

/** 顯示 */
let display = false;

/** ajax Obserable */
let stores = Observable.ajax({ method: 'get', url: storeUrl, crossDomain: true });

/** 建立 select options */
const renderSelectOption: renderSelectOptionInterface = (suggestArr: object[]): void => {
    let cityString, townString, storeString;
    cityString = townString = storeString = '<option value="" data-num="" data-store="" >尚無資料</option>';
    if(suggestArr) {
        cityString = suggestArr.map( (item: any, index) => {
            return '<option value="'+ item.name +'" data-num="'+ index +'" >'+ item.name +'</option>';
        }).join('');
    }
    cityDOM.innerHTML = cityString;
    townDOM.innerHTML = townString;
    storeDOM.innerHTML = storeString;
    console.log(cityString);
}
/** get json */
stores.map(response => response.response.stores)
    .subscribe(
        (x) => {
            console.info(x);
            if(x !== undefined) localStorage.setItem('stores', JSON.stringify(x));
            let store: object[] = JSON.parse( <string>localStorage.getItem('stores') );
            renderSelectOption( store );
            // return store;
        },
        () => { console.log('can\'t connection'); },
        () => { console.log('complete'); }
);


